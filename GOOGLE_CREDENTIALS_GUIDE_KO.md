# 구글 인증 키(자격 증명) 발급 가이드

구글 인증 키 발급 절차를 사용 목적별로 간단히 정리했습니다. 먼저 어떤 키가 필요한지부터 확인하세요.

## 무엇을 발급하나요?

- OAuth 클라이언트 ID: 사용자 로그인(Google 로그인), 사용자 동의가 필요한 API 호출에 사용
- API 키: 공개/경량 API 호출용(예: Maps JS). 사용자 인증 대신 간단한 호출 제한용
- 서비스 계정 키: 서버 간 백엔드 작업, 배치 작업, GCS/BigQuery 등 서버 권한이 필요한 경우

## 공통 준비

- 프로젝트 생성: Google Cloud Console → 상단 프로젝트 선택 → 새 프로젝트
- 결제 설정: 일부 API는 결제 계정 연동 필요. 결제 → 결제 계정 연결
- API 활성화: API 및 서비스 → 라이브러리 → 필요한 API 검색 → 사용 설정
- 관리 경로: API 및 서비스 → 사용자 인증 정보(Credentials)에서 모든 키를 관리

## OAuth 클라이언트 ID 발급 (Google 로그인 등)

1) OAuth 동의화면 구성: API 및 서비스 → OAuth 동의화면 → 사용자 유형(내부/외부) 선택 → 앱 정보 입력

- 범위(Scopes) 최소화, 개발 단계에서는 테스트 사용자 추가
- 프로덕션에서 민감/제한 범위 사용 시 Google 검수 필요

2) 클라이언트 만들기: 사용자 인증 정보 → 사용자 인증 정보 만들기 → OAuth 클라이언트 ID

- 앱 유형 선택: 웹 애플리케이션 / Android / iOS / 데스크탑 등
- 리디렉션 URI 등록(웹): 예) `https://your-domain.com/auth/callback`
- 결과: 클라이언트 ID와 클라이언트 보안 비밀(Client secret) 획득

3) 사용처 설정

- 웹/서버: 라이브러리(SDK) 설정 시 클라이언트 ID/시크릿 지정
- 모바일: 리버스 클라이언트 ID 혹은 SHA-1 인증서 지문 등록 필요(Android)

## API 키 발급 (지도 등 경량 호출)

- 생성: 사용자 인증 정보 → 사용자 인증 정보 만들기 → API 키
- 제한 강제:
  - 애플리케이션 제한: HTTP referrer(웹), IP 주소(서버), Android 앱 패키지+SHA-1, iOS 번들 ID
  - API 제한: 이 키가 호출할 API만 선택
- 노출 방지: 프론트에 두더라도 도메인/패키지 제한 필수. 유출 시 즉시 회전

## 서비스 계정 키 발급 (백엔드/배치)

- 서비스 계정 생성: IAM 및 관리자 → 서비스 계정 → 만들기 → 역할 최소 부여
- 키 발급: 서비스 계정 상세 → 키 → 키 추가 → 새 키 만들기 → JSON 선택 → 다운로드(`.json`)
- 애플리케이션 연결:
  - 환경변수 `GOOGLE_APPLICATION_CREDENTIALS=/path/key.json` 설정 또는 라이브러리에서 경로 지정
  - 워크로드 아이덴티티/시크릿 매니저 사용 권장(키 파일 배포 최소화)
- 보안: 키 파일은 저장소에 커밋 금지(`.gitignore`), 접근권한 최소화, 정기 교체

## 자주 쓰는 조합 예

- 웹에서 Google 로그인: OAuth 동의화면 구성 → OAuth 클라이언트(웹) → 리디렉션 URI 등록 → ID/시크릿으로 로그인 구현
- 서버에서 Gmail/Drive API 처리: 서비스 계정 생성 → 필요한 역할/도메인 전체 위임(필요 시) → 키 JSON으로 서버에서 인증
- Google Maps JavaScript: API 키 생성 → HTTP referrer로 도메인 제한 → Maps JavaScript API만 허용

## 보안/운영 팁

- 최소 권한: 역할/범위 최소화, 필요 시에만 확장
- 비밀 관리: 시크릿 매니저/환경변수 사용, 저장소 커밋 금지
- 키 제한/회전: API 키는 반드시 앱/도메인/IP 제한, 유출 감지 시 즉시 회전
- 모니터링: API 및 서비스 → 대시보드/할당량에서 사용량·오류 확인, 알림 설정
- 검수 대비: 민감 범위 사용 시 개인정보 처리방침, 도메인 소유권, 스크린샷 등 준비

## 문제 해결

- `redirect_uri_mismatch`: 리디렉션 URI가 콘솔에 등록된 값과 정확히 일치하도록 설정
- `invalid_client` / `invalid_client_secret`: 올바른 프로젝트의 최신 클라이언트 정보 사용
- 403/권한 오류: API 활성화 여부, 할당량, 서비스 계정 권한 재확인
- Android/iOS 오류: 패키지명/번들ID, SHA-1/팀ID 등 서명 정보 일치 확인

---

원하시는 사용처(웹 로그인, 지도, 서버 백엔드 등)를 알려주시면, 실제 화면 경로와 설정값 예시까지 맞춤형으로 추가 안내해 드리겠습니다.

